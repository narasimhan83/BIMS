@{
    var currentLang = Context.Session.GetString("Language") ?? "en";
    var dir = currentLang == "ar" ? "rtl" : "ltr";
    var isPopup = !string.IsNullOrEmpty(Context.Request.Query["isPopup"]);
}
<!DOCTYPE html>
<html lang="@currentLang" dir="@dir">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - AEGIS Insurance</title>
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    @if (currentLang == "ar")
    {
        <link rel="stylesheet" href="~/css/rtl.css" asp-append-version="true" id="rtl-css" />
    }
    @await RenderSectionAsync("Styles", required: false)
</head>
<body class="@(currentLang == "ar" ? "arabic" : "english")">
    @if (!isPopup)
    {
        <header>
            <nav class="navbar">
                <div class="navbar-container">
                    <div class="navbar-brand">
                        <img src="~/images/aegis-logo.png" alt="AEGIS Logo" class="navbar-logo" />
                        <span class="navbar-title">AEGIS IBMS</span>
                    </div>
                        @if (User.Identity?.IsAuthenticated ?? false)
                        {
                            <div class="navbar-links">
                        <a asp-controller="Home" asp-action="Dashboard" class="nav-link">
                            <span>ğŸ“Š</span> @(currentLang == "ar" ? "Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…" : "Dashboard")
                        </a>
                        <div class="dropdown">
                            <button class="dropdown-toggle">
                                <span>âš™ï¸</span> @(currentLang == "ar" ? "Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª" : "Masters") <span class="arrow">â–¼</span>
                            </button>
                            <div class="dropdown-menu">
                                <a asp-controller="Masters" asp-action="CustomerTypes" class="dropdown-item">
                                    <span>ğŸ‘¥</span> @(currentLang == "ar" ? "Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡" : "Customer Types")
                                </a>
                                <a asp-controller="Masters" asp-action="DocumentTypes" class="dropdown-item">
                                    <span>ğŸ“„</span> @(currentLang == "ar" ? "Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª" : "Document Types")
                                </a>
                                <a asp-controller="Masters" asp-action="BusinessTypes" class="dropdown-item">
                                    <span>ğŸ’¼</span> @(currentLang == "ar" ? "Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„" : "Business Types")
                                </a>
                                <a asp-controller="Masters" asp-action="SalesTypes" class="dropdown-item">
                                    <span>ğŸ’°</span> @(currentLang == "ar" ? "Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª" : "Sales Types")
                                </a>
                                <a asp-controller="Masters" asp-action="LeadSources" class="dropdown-item">
                                    <span>ğŸ¯</span> @(currentLang == "ar" ? "Ù…ØµØ§Ø¯Ø± Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù…Ø­ØªÙ…Ù„ÙŠÙ†" : "Lead Sources")
                                </a>
                                <a asp-controller="Masters" asp-action="CalculationMethods" class="dropdown-item">
                                    <span>ğŸ§®</span> @(currentLang == "ar" ? "Ø·Ø±Ù‚ Ø§Ù„Ø­Ø³Ø§Ø¨" : "Calculation Methods")
                                </a>
                                <a asp-controller="Masters" asp-action="ExcessTypes" class="dropdown-item">
                                    <span>ğŸ§¾</span> @(currentLang == "ar" ? "Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØªØ­Ù…Ù„" : "Excess Types")
                                </a>
                                <div class="dropdown-divider"></div>
                                <div class="dropdown-submenu-header">@(currentLang == "ar" ? "ğŸ“ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹" : "ğŸ“ Location Management")</div>
                                <a asp-controller="Masters" asp-action="Countries" class="dropdown-item dropdown-subitem">
                                    <span>ğŸŒ</span> @(currentLang == "ar" ? "Ø§Ù„Ø¯ÙˆÙ„" : "Countries")
                                </a>
                                <a asp-controller="Masters" asp-action="States" class="dropdown-item dropdown-subitem">
                                    <span>ğŸ—ºï¸</span> @(currentLang == "ar" ? "Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª" : "States")
                                </a>
                                <a asp-controller="Masters" asp-action="Cities" class="dropdown-item dropdown-subitem">
                                    <span>ğŸ™ï¸</span> @(currentLang == "ar" ? "Ø§Ù„Ù…Ø¯Ù†" : "Cities")
                                </a>
                                <div class="dropdown-divider"></div>
                                <div class="dropdown-submenu-header">@(currentLang == "ar" ? "ğŸ’° Ø§Ù„Ù…Ø§Ù„ÙŠØ©" : "ğŸ’° Finance")</div>
                                <a asp-controller="Finance" asp-action="Banks" class="dropdown-item dropdown-subitem">
                                    <span>ğŸ¦</span> @(currentLang == "ar" ? "Ø§Ù„Ø¨Ù†ÙˆÙƒ" : "Banks")
                                </a>
                                <div class="dropdown-divider"></div>
                                <div class="dropdown-submenu-header">@(currentLang == "ar" ? "ğŸš— Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª" : "ğŸš— Vehicle Management")</div>
                                <a asp-controller="Vehicle" asp-action="VehicleMakes" class="dropdown-item dropdown-subitem">
                                    <span>ğŸ­</span> @(currentLang == "ar" ? "ØµÙ†Ø§Ø¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª" : "Vehicle Makes")
                                </a>
                                <a asp-controller="Vehicle" asp-action="VehicleModels" class="dropdown-item dropdown-subitem">
                                    <span>ğŸš™</span> @(currentLang == "ar" ? "Ù…ÙˆØ¯ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª" : "Vehicle Models")
                                </a>
                                <a asp-controller="Vehicle" asp-action="VehicleYears" class="dropdown-item dropdown-subitem">
                                    <span>ğŸ“…</span> @(currentLang == "ar" ? "Ø³Ù†ÙˆØ§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬" : "Vehicle Years")
                                </a>
                                <a asp-controller="Vehicle" asp-action="EngineCapacities" class="dropdown-item dropdown-subitem">
                                    <span>âš™ï¸</span> @(currentLang == "ar" ? "Ø³Ø¹Ø© Ø§Ù„Ù…Ø­Ø±Ùƒ" : "Engine Capacity")
                                </a>
                                <a asp-controller="Masters" asp-action="VehicleTypes" class="dropdown-item dropdown-subitem">
                                    <span>ğŸš—</span> @(currentLang == "ar" ? "Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª" : "Vehicle Types")
                                </a>
                                <a asp-controller="Masters" asp-action="VehicleCategories" class="dropdown-item dropdown-subitem">
                                    <span>ğŸš˜</span> @(currentLang == "ar" ? "ÙØ¦Ø§Øª Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª" : "Vehicle Categories")
                                </a>
                                <a asp-controller="Masters" asp-action="ValueBands" class="dropdown-item dropdown-subitem">
                                    <span>ğŸ“Š</span> @(currentLang == "ar" ? "Ø´Ø±Ø§Ø¦Ø­ Ø§Ù„Ù‚ÙŠÙ…Ø©" : "Value Bands")
                                </a>
                            </div>
                        </div>
                        <div class="dropdown">
                            <button class="dropdown-toggle">
                                <span>ğŸ‘¥</span> @(currentLang == "ar" ? "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡" : "Agents Management") <span class="arrow">â–¼</span>
                            </button>
                            <div class="dropdown-menu">
                                <a asp-controller="Agents" asp-action="Index" class="dropdown-item">
                                    <span>ğŸ‘¤</span> @(currentLang == "ar" ? "Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡" : "Agents")
                                </a>
                            </div>
                        </div>
                        <div class="dropdown">
                            <button class="dropdown-toggle">
                                <span>ğŸ¢</span> @(currentLang == "ar" ? "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡" : "Customer Management") <span class="arrow">â–¼</span>
                            </button>
                            <div class="dropdown-menu">
                                <a asp-controller="Customer" asp-action="Customers" class="dropdown-item">
                                    <span>ğŸ‘¤</span> @(currentLang == "ar" ? "Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡" : "Customers")
                                </a>
                                <a asp-controller="Customer" asp-action="Groups" class="dropdown-item">
                                    <span>ğŸ‘¥</span> @(currentLang == "ar" ? "Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª" : "Groups")
                                </a>
                            </div>
                        </div>
                        <div class="dropdown">
                            <button class="dropdown-toggle">
                                <span>ğŸ›¡ï¸</span> @(currentLang == "ar" ? "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ£Ù…ÙŠÙ†" : "Insurance Management") <span class="arrow">â–¼</span>
                            </button>
                            <div class="dropdown-menu">
                                <a asp-controller="InsuranceClients" asp-action="Index" class="dropdown-item">
                                    <span>ğŸ‘¥</span> @(currentLang == "ar" ? "Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„ØªØ£Ù…ÙŠÙ†" : "Insurance Clients")
                                </a>
                                <a asp-controller="InsuranceClients" asp-action="LinesOfBusiness" class="dropdown-item">
                                    <span>ğŸ“‹</span> @(currentLang == "ar" ? "Ø®Ø·ÙˆØ· Ø§Ù„Ø£Ø¹Ù…Ø§Ù„" : "Lines of Business")
                                </a>
                                <div class="dropdown-divider"></div>
                                <a asp-controller="Insurance" asp-action="ProductClasses" class="dropdown-item">
                                    <span>ğŸ“¦</span> @(currentLang == "ar" ? "ÙØ¦Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª" : "Product Classes")
                                </a>
                                <a asp-controller="Insurance" asp-action="ProductTypes" class="dropdown-item">
                                    <span>ğŸ·ï¸</span> @(currentLang == "ar" ? "Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª" : "Product Types")
                                </a>
                                <a asp-controller="InsurancePlans" asp-action="Index" class="dropdown-item">
                                    <span>ğŸ›¡ï¸</span> @(currentLang == "ar" ? "Ø®Ø·Ø· Ø§Ù„ØªØ£Ù…ÙŠÙ†" : "Insurance Plans")
                                </a>
                                <div class="dropdown-divider"></div>
                                <div class="dropdown-submenu-header">@(currentLang == "ar" ? "ğŸš— ØªØ£Ù…ÙŠÙ† Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª" : "ğŸš— Motors")</div>
                                <a asp-controller="CoverageCategories" asp-action="Index" class="dropdown-item dropdown-subitem">
                                    <span>ğŸ“‚</span> @(currentLang == "ar" ? "ÙØ¦Ø§Øª Ø§Ù„ØªØºØ·ÙŠØ©" : "Coverage Categories")
                                </a>
                                <a asp-controller="BenefitTypes" asp-action="Index" class="dropdown-item dropdown-subitem">
                                    <span>ğŸ§¾</span> @(currentLang == "ar" ? "Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ù†Ø§ÙØ¹" : "Benefit Types")
                                </a>
                                <a asp-controller="AdditionalCovers" asp-action="Index" class="dropdown-item dropdown-subitem">
                                    <span>â•</span> @(currentLang == "ar" ? "ØªØºØ·ÙŠØ§Øª Ø¥Ø¶Ø§ÙÙŠØ©" : "Additional Covers")
                                </a>
                                <a asp-controller="SpecialConditions" asp-action="Index" class="dropdown-item dropdown-subitem">
                                    <span>âš–ï¸</span> @(currentLang == "ar" ? "Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø®Ø§ØµØ©" : "Special Conditions")
                                </a>
                                <a asp-controller="PlanBenefits" asp-action="Index" class="dropdown-item dropdown-subitem">
                                    <span>ğŸ›¡ï¸</span> @(currentLang == "ar" ? "Ù…Ù†Ø§ÙØ¹ Ø§Ù„Ø®Ø·Ø©" : "Plan Benefits")
                                </a>
                                <a asp-controller="ComprehensiveTariffs" asp-action="Index" class="dropdown-item dropdown-subitem">
                                    <span>ğŸ“Š</span> @(currentLang == "ar" ? "ØªØ¹Ø±ÙØ© Ø´Ø§Ù…Ù„Ø©" : "Comprehensive Tariff")
                                </a>
                                <a asp-controller="ThirdPartyTariffs" asp-action="Index" class="dropdown-item dropdown-subitem">
                                    <span>ğŸ“Š</span> @(currentLang == "ar" ? "ØªØ¹Ø±ÙØ© Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø«Ø§Ù„Ø«" : "Third Party Tariff")
                                </a>
                                <a asp-controller="CommercialTariffs" asp-action="Index" class="dropdown-item dropdown-subitem">
                                    <span>ğŸ“Š</span> @(currentLang == "ar" ? "ØªØ¹Ø±ÙØ© ØªØ¬Ø§Ø±ÙŠØ©" : "Commercial Tariff")
                                </a>
                                <a asp-controller="PlanExcesses" asp-action="Index" class="dropdown-item dropdown-subitem">
                                    <span>ğŸ“Š</span> @(currentLang == "ar" ? "ØªØ­Ù…Ù„Ø§Øª Ø§Ù„Ø®Ø·Ø©" : "Plan Excess")
                                </a>
                                <a asp-controller="PlanAdditionalCovers" asp-action="Index" class="dropdown-item dropdown-subitem">
                                    <span>â•</span> @(currentLang == "ar" ? "ØªØºØ·ÙŠØ§Øª Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©" : "Plan Additional Cover")
                                </a>
                            </div>
                        </div>
                        <div class="dropdown">
                            <button class="dropdown-toggle">
                                <span>ğŸ¯</span> @(currentLang == "ar" ? "Ø¥Ø¯Ø§Ø±Ø© Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡" : "CRM") <span class="arrow">â–¼</span>
                            </button>
                            <div class="dropdown-menu">
                                <a asp-controller="Leads" asp-action="Index" class="dropdown-item">
                                    <span>ğŸ‘¥</span> @(currentLang == "ar" ? "Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù…Ø­ØªÙ…Ù„ÙˆÙ†" : "Leads")
                                </a>
                                <a asp-controller="Proposals" asp-action="Index" class="dropdown-item">
                                    <span>ğŸ“‹</span> @(currentLang == "ar" ? "Ø§Ù„Ø¹Ø±ÙˆØ¶" : "Proposals")
                                </a>
                            </div>
                        </div>
                        <div class="dropdown">
                            <button class="dropdown-toggle">
                                <span>ğŸ“‹</span> @(currentLang == "ar" ? "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚" : "Policy Management")
                            </button>
                            <div class="dropdown-menu">
                                <a asp-controller="Policies" asp-action="Index" class="dropdown-item">
                                    <span>ğŸ“„</span> @(currentLang == "ar" ? "Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚" : "Policies")
                                </a>
                            </div>
                        </div>
                        <div class="dropdown">
                            <button class="dropdown-toggle">
                                <span>ğŸ’°</span> @(currentLang == "ar" ? "Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª" : "Sales") <span class="arrow">â–¼</span>
                            </button>
                            <div class="dropdown-menu">
                                <a asp-controller="SalesInvoices" asp-action="Index" class="dropdown-item">
                                    <span>ğŸ“„</span> @(currentLang == "ar" ? "ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª" : "Sales Invoices")
                                </a>
                                <a asp-controller="CreditNotes" asp-action="Index" class="dropdown-item">
                                    <span>ğŸ“</span> @(currentLang == "ar" ? "Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø§Ø¦ØªÙ…Ø§Ù†" : "Credit Notes")
                                </a>
                                <a asp-controller="CustomerPayments" asp-action="Index" class="dropdown-item">
                                    <span>ğŸ’³</span> @(currentLang == "ar" ? "Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡" : "Customer Payments")
                                </a>
                            </div>
                        </div>
                    </div>
                }
                <div class="navbar-menu">
                    @if (User.Identity?.IsAuthenticated ?? false)
                    {
                        <div class="language-switcher">
                            <button onclick="setLanguage('en')" class="lang-btn lang-btn-en @(currentLang == "en" ? "active" : "")" id="btn-en">
                                <span>ğŸ‡¬ğŸ‡§</span> English
                            </button>
                            <button onclick="setLanguage('ar')" class="lang-btn lang-btn-ar @(currentLang == "ar" ? "active" : "")" id="btn-ar">
                                <span>ğŸ‡¸ğŸ‡¦</span> Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
                            </button>
                        </div>
                        <span class="navbar-user">@(currentLang == "ar" ? "Ø£Ù‡Ù„Ø§Ù‹" : "Welcome"), @User.Identity.Name</span>
                        <form asp-controller="Account" asp-action="Logout" method="post" class="logout-form">
                            <button type="submit" class="btn-logout">@(currentLang == "ar" ? "ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬" : "Logout")</button>
                        </form>
                    }
                </div>
            </div>
        </nav>
    </header>
    }
    
    <main role="main" class="main-content">
        @RenderBody()
    </main>

    @if (!isPopup)
    {
        <footer class="footer">
            <div class="container">
                &copy; @DateTime.Now.Year - AEGIS Insurance & Reinsurance Brokers W.L.L - All Rights Reserved
            </div>
        </footer>
    }

    <!-- jQuery needed for Summernote (loaded once globally) -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
            integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
            crossorigin="anonymous"></script>

    <script src="~/js/language-switcher.js" asp-append-version="true"></script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>